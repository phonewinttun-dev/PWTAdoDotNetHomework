<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product CRUD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">
    <h2 class="mb-4">üõçÔ∏è Product Management</h2>

    <div class="mb-3">
        <label class="form-label">Product Name</label>
        <input type="text" class="form-control" id="txtName">
    </div>

    <div class="mb-3">
        <label class="form-label">Quantity</label>
        <input type="number" class="form-control" id="txtQty" min="0">
    </div>

    <div class="mb-3">
        <label class="form-label">Price</label>
        <input type="number" class="form-control" id="txtPrice" min="0" step="0.01">
    </div>

    <button class="btn btn-primary me-2" onclick="save()">Save</button>
    <a href="sell.html" class="btn btn-success">Go to Sell Page</a>

    <hr>

    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>Action</th>
                <th>#</th>
                <th>Id</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Price ($)</th>
            </tr>
        </thead>
        <tbody id="tbData"></tbody>
    </table>

    <script>
        loadData();

        function getData() {
            let data = localStorage.getItem('products');
            return data ? JSON.parse(data) : [];
        }

        function saveData(lst) {
            localStorage.setItem('products', JSON.stringify(lst));
        }

        function loadData() {
            let lst = getData();
            const tb = document.getElementById('tbData');
            tb.innerHTML = '';
            lst.forEach((item, i) => {
                tb.innerHTML += `
                <tr>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="edit('${item.Id}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteData('${item.Id}')">Delete</button>
                    </td>
                    <td>${i + 1}</td>
                    <td>${item.Id}</td>
                    <td>${item.Name}</td>
                    <td>${item.Quantity}</td>
                    <td>${item.Price.toFixed(2)}</td>
                </tr>`;
            });
        }

        var editId = null;

        function save() {
            let name = document.getElementById('txtName').value.trim();
            let qty = parseInt(document.getElementById('txtQty').value);
            let price = parseFloat(document.getElementById('txtPrice').value);

            if (!name || isNaN(qty) || isNaN(price)) {
                alert("Please fill all fields correctly!");
                return;
            }

            let lst = getData();

            if (editId) {
                // update
                let index = lst.findIndex(x => x.Id === editId);
                lst[index].Name = name;
                lst[index].Quantity = qty;
                lst[index].Price = price;
                editId = null;
            } else {
                // add
                let newItem = {
                    Id: crypto.randomUUID(),
                    Name: name,
                    Quantity: qty,
                    Price: price
                };
                lst.push(newItem);
            }

            saveData(lst);
            loadData();
            clearInput();
        }

        function clearInput() {
            document.getElementById('txtName').value = '';
            document.getElementById('txtQty').value = '';
            document.getElementById('txtPrice').value = '';
        }

        function edit(id) {
            let lst = getData();
            let item = lst.find(x => x.Id === id);
            if (!item) return;

            document.getElementById('txtName').value = item.Name;
            document.getElementById('txtQty').value = item.Quantity;
            document.getElementById('txtPrice').value = item.Price;
            editId = id;
        }

        function deleteData(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            let lst = getData().filter(x => x.Id !== id);
            saveData(lst);
            loadData();
        }
    </script>
</body>

</html>
